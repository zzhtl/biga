# BigA 股票预测系统文档

> **版本**: V3.1  
> **更新日期**: 2025-09-30  
> **适用市场**: 中国A股

---

## 目录

1. [系统概述](#1-系统概述)
2. [快速开始](#2-快速开始)
3. [技术指标体系](#3-技术指标体系)
4. [模型架构与训练](#4-模型架构与训练)
5. [预测逻辑](#5-预测逻辑)
6. [权重配置指南](#6-权重配置指南)
7. [常见问题](#7-常见问题)
8. [版本更新日志](#8-版本更新日志)

---

## 1. 系统概述

### 1.1 技术栈

| 层级 | 技术 |
|-----|-----|
| 后端 | Rust + Tauri + Candle (深度学习) |
| 前端 | Svelte + TypeScript |
| 数据库 | SQLite |
| AI模型 | 4层深度神经网络 (256→128→64→32) |

### 1.2 主要功能

- **金融级预测** - 专业买卖点分析
- **智能训练** - 自动优化的深度学习模型
- **多周期分析** - 日线/周线/月线共振
- **技术指标** - 60+ 技术指标实时计算
- **量价分析** - OBV、VR、MFI等
- **K线形态** - 10+ 形态自动识别
- **多因子评分** - 8大维度综合评分

---

## 2. 快速开始

### 2.1 安装运行

```bash
npm install
cd src-tauri && cargo build --release
npm run tauri dev
```

### 2.2 基础使用流程

```
1. 输入股票代码 (如: 600519)
2. 点击"获取历史数据"
3. 点击"训练模型" (首次使用)
4. 点击"💎 金融级预测"
5. 查看预测结果和买卖建议
```

### 2.3 推荐训练参数

```json
{
  "epochs": 100,
  "batch_size": 32,
  "learning_rate": 0.001,
  "dropout": 0.3,
  "prediction_days": 5
}
```

### 2.4 数据要求

| 数据量 | 训练效果 |
|--------|---------|
| < 120天 | ❌ 不足 |
| 120-180天 | ⚠️ 勉强可用 |
| 180-250天 | ✅ 推荐 |
| 250天+ | ✅ 最佳 |

---

## 3. 技术指标体系

### 3.1 新增专业指标 (8大指标)

| 指标 | 函数 | 用途 | 阈值说明 |
|-----|------|-----|---------|
| ATR | `calculate_atr(highs, lows, closes, 14)` | 波动率评估 | <1.5%稳定, 1.5-3%中等, >3%高波动 |
| 布林带 | `calculate_bollinger_bands(prices, 20, 2.0)` | 超买超卖 | 触上轨超买, 触下轨超卖 |
| SAR | `calculate_sar_signal(highs, lows, 0.02, 0.2)` | 趋势反转 | SAR在价格下方看涨, 上方看跌 |
| DMI/ADX | `calculate_dmi_adx(highs, lows, closes, 14)` | 趋势强度 | ADX>40强趋势, 25-40中等, <20震荡 |
| 威廉%R | `calculate_williams_r(highs, lows, closes, 14)` | 超买超卖 | <-80超卖, >-20超买 |
| ROC | `calculate_roc(prices, 12)` | 动量分析 | >0上涨动能, <0下跌动能 |
| 市场情绪 | `calculate_market_sentiment(...)` | 恐惧贪婪 | 0-100情绪得分 |
| 多因子评分 | `calculate_multi_factor_score(factors)` | 综合评分 | 8维度智能评分 |

### 3.2 趋势类指标

**移动平均线 (MA)**
```
MA5: 超短期  |  MA10: 短期  |  MA20: 中期  |  MA60: 长期
多头排列: MA5 > MA10 > MA20 > MA60 → 强势
空头排列: MA5 < MA10 < MA20 < MA60 → 弱势
```

**MACD**
```
金叉: DIF上穿DEA → 买入信号
死叉: DIF下穿DEA → 卖出信号
```

### 3.3 动量类指标

**RSI**
```
> 70: 超买  |  60-70: 强势  |  40-60: 中性  |  30-40: 弱势  |  < 30: 超卖
```

**KDJ**
```
J > 100: 超买  |  J < 0: 超卖
K上穿D: 金叉买入  |  K下穿D: 死叉卖出
```

### 3.4 K线形态识别

| 类型 | 形态 |
|-----|-----|
| 单根 | 锤子线、射击之星、十字星 |
| 双根 | 看涨吞没、看跌吞没、刺透形态、乌云盖顶 |
| 三根 | 早晨之星、黄昏之星、三白兵、三乌鸦 |

---

## 4. 模型架构与训练

### 4.1 深度神经网络架构

```
输入层 (特征数)
   ↓
第1层 [256维] + ReLU + Dropout(30%)  # 特征提取
   ↓
第2层 [128维] + ReLU + Dropout(24%)  # 深度学习
   ↓
第3层 [64维] + ReLU + Dropout(18%)   # 模式识别
   ↓
第4层 [32维] + ReLU + Dropout(12%)   # 深度抽象
   ↓  ↖ (残差连接)
输出层 [1维] - 价格预测
```

### 4.2 训练优化技术

| 技术 | 配置 | 说明 |
|-----|------|-----|
| 学习率调度 | 每20 epoch衰减5% | 早期快速收敛, 后期精细调优 |
| 早停机制 | patience=15, min_delta=0.0001 | 15个epoch无改进自动停止 |
| L2正则化 | λ=0.0001 | 防止过拟合 |
| Dropout | 30%→24%→18%→12% | 逐层递减, 集成学习效果 |
| 残差连接 | 输入直连第4层 | 改善梯度流动 |

### 4.3 训练监控

**好的训练表现**:
```
✅ 验证Loss逐渐下降
✅ 训练Loss和验证Loss差距<30%
✅ 早停在50-80 epoch触发
```

**过拟合警告**:
```
❌ 验证Loss上升
❌ 训练Loss和验证Loss差距>50%
```

### 4.4 集成学习

```rust
// 五种集成策略
- WeightedAverage  // 加权平均
- Voting           // 投票机制
- Stacking         // 堆叠泛化
- DynamicSelection // 动态选择
- Hybrid           // 混合策略（推荐）
```

**风险评估输出**:
```rust
risk_level: "低"/"中"/"高"/"极高"
uncertainty_score: 不确定性得分
model_disagreement: 模型分歧度
recommendation: 操作建议
```

---

## 5. 预测逻辑

### 5.1 买入点识别

| 类型 | 触发条件 | 止损位 | 止盈位 |
|-----|---------|-------|-------|
| 支撑买入 | 距离支撑位<3% | 支撑位-2% | +3%, +5%, +8% |
| 突破买入 | 突破压力位+放量 | 压力位-2% | +5%, +8%, +12% |
| 趋势买入 | MA5>MA10>MA20 | MA20 | +5%, +10% |
| 底部买入 | RSI<30+底部形态 | 近期低点-3% | +10%, +15%, +20% |

### 5.2 卖出点识别

| 类型 | 触发条件 | 理由 |
|-----|---------|-----|
| 压力卖出 | 距离压力位<2% | 上方压力强 |
| 止盈卖出 | 涨幅>=预期 | 落袋为安 |
| 破位卖出 | 跌破关键支撑 | 趋势转弱 |
| 顶部卖出 | RSI>80+顶部形态 | 超买严重 |

### 5.3 多周期共振

| 共振级别 | 信号强度 | 操作建议 |
|---------|---------|---------|
| 3级共振 | 最强 | 强烈买入/卖出信号 |
| 2级共振 | 较强 | 买入/卖出信号 |
| 1级共振 | 一般 | 谨慎观察 |

### 5.4 V3.1核心修复

**解决持续上涨问题**:

1. **双向波动** - 使用sin/cos产生正负交替波动, 不再单向放大趋势
2. **均值回归** - 偏离均线>3%触发回归, >5%强制回归
3. **快速趋势衰减** - 衰减系数从0.93改为0.90
4. **趋势强度限制** - 最大±2%, 防止极端预测
5. **权重平衡** - 趋势权重降至70%, 加入均值回归力量

**修复效果**:
| 指标 | 修复前 | 修复后 |
|-----|-------|-------|
| 连续上涨天数 | 5/5天 | 3/5天 |
| 5日累计涨幅 | +17.4% | +5.0% |
| 最大单日涨幅 | +4.1% | +1.5% |

---

## 6. 权重配置指南

### 6.1 核心配置文件

**`src-tauri/src/config/weights.rs`** - 核心权重配置 (优先调整)

### 6.2 多因子评分权重 (总和=100%)

| 因子 | 权重 | 适合场景 | 调高时机 | 调低时机 |
|-----|-----|---------|---------|---------|
| 趋势因子 | 22% | 趋势市 | 牛市/熊市 | 震荡市 |
| 量价因子 | 18% | 量价配合好 | 放量明显 | 量能噪音大 |
| 多周期共振 | 15% | 共振明确 | 多周期一致 | 周期冲突 |
| 动量因子 | 13% | 动量明显 | 指标有效 | 指标钝化 |
| K线形态 | 12% | 短期交易 | 形态准确 | 关注趋势 |
| 支撑压力 | 10% | 关键位 | 位置有效 | 频繁突破 |
| 市场情绪 | 7% | 情绪极端 | 恐慌/狂热 | 情绪平稳 |
| 波动率 | 3% | 风险控制 | 控制风险 | 正常波动 |

### 6.3 预测算法核心权重

| 权重 | 默认值 | 建议范围 | 说明 |
|-----|-------|---------|-----|
| 趋势占比 | 40% | 30-50% | 过高→追涨杀跌 |
| 技术指标占比 | 30% | 20-40% | 影响短期波动捕捉 |
| 均线量能占比 | 20% | 15-25% | 影响中期趋势 |
| 市场波动占比 | 12% | 8-15% | 影响预测平滑度 |
| 基础模型占比 | 10% | 5-15% | 过高→过拟合 |

### 6.4 常见问题调优

| 问题现象 | 调整参数 | 调整方向 |
|---------|---------|---------|
| 追涨杀跌 | PREDICTION_TREND_RATIO | 40%→35% |
| 方向频繁错误 | 趋势一致性系数 | 提高反向抑制 |
| 震荡市表现差 | 支撑压力+形态权重 | 各+2% |
| 趋势市错失机会 | 趋势+多周期权重 | 各+3% |

### 6.5 调优步骤

```
1. 基准回测 - 记录当前准确率
2. 问题诊断 - 定位问题类型
3. 调整权重 - 每次只改1-2个参数, ±5%
4. 验证效果 - cargo run --example test_backtest
5. 记录归档 - 效果不佳则git回滚
```

---

## 7. 常见问题

### Q1: 预测准确率有多高？
- 方向准确率: 65-70%
- 价格误差: ±2.0-2.5%
- 实际效果取决于市场环境和数据质量

### Q2: 多久需要重新训练？
- 每季度重新训练
- 新数据积累50+天时
- 准确率下降10%以上时
- 市场环境剧变时

### Q3: 如何判断模型好坏？
```
好的模型:
✅ 验证Loss逐渐下降
✅ 训练Loss和验证Loss差距<30%
✅ 方向准确率>60%

差的模型:
❌ 验证Loss上升
❌ 差距>50%
❌ 方向准确率<55%
```

### Q4: 重训练提示"找不到模型"？
- 确认选择了正确的股票代码
- 刷新页面后重试
- 切换股票代码后模型列表会自动刷新

### Q5: 评分系统说明

**多因子总分 (0-100分)**
| 分数 | 等级 | 信号强度 |
|-----|-----|---------|
| 90-100 | 极强 | 🔥 |
| 80-89 | 强 | ✅ |
| 70-79 | 较强 | 📈 |
| 60-69 | 中等 | ⚖️ |
| 50-59 | 偏弱 | 📉 |
| 0-49 | 弱 | ⚠️ |

**风险等级**
| 等级 | 分数 | 建议 |
|-----|-----|-----|
| 低 | 1-3 | 正常仓位 |
| 中 | 4-6 | 半仓操作 |
| 较高 | 7-8 | 轻仓或观望 |
| 高 | 9-10 | 强烈建议观望 |

---

## 8. 版本更新日志

### V3.1 (2025-09-30) - 预测逻辑修复

**核心修复**:
- ✅ 双向波动机制 - 解决持续上涨问题
- ✅ 均值回归 - 偏离均线会自动回归
- ✅ 快速趋势衰减 - 远期预测不确定性增加
- ✅ 预测理由生成

**效果提升**:
- 5日累计涨幅: 17.4% → 5.0% (-71%)
- 连续上涨天数: 5/5 → 3/5 (有涨有跌)

### V3.0 (2025-09-30) - 模型优化

- ✅ 4层深度神经网络 (256→128→64→32)
- ✅ ReLU + Dropout + 残差连接
- ✅ 学习率调度 + 早停机制
- ✅ L2正则化

### V2.1 (2025-09-30) - 权重修复

- ✅ 修正基础权重总和为100% (原120%)
- ✅ 修正各因子评分逻辑, 确保0-100范围
- ✅ 修正RSI超买逻辑 (扣分而非加分)
- ✅ 增加权重上下限保护 (2%-30%)

### V2.0 (2025-09-30) - 功能增强

- ✅ 8大专业技术指标
- ✅ 多因子综合评分 (8维度)
- ✅ 市场情绪分析
- ✅ 智能权重动态调整
- ✅ 量价分析增强
- ✅ K线形态识别

---

## 风险提示

> **⚠️ 重要声明**
> 
> 1. **预测≠保证** - 模型基于历史数据, 无法预知突发事件
> 2. **市场有风险** - 股市涨跌不可控, 可能亏损本金
> 3. **不构成投资建议** - 仅供参考, 自行判断, 自负盈亏
> 4. **综合分析** - 投资决策 = 模型预测 + 技术分析 + 基本面 + 风险管理

### 投资建议

**仓位管理**
```
强烈信号: 30-50%仓位
一般信号: 10-30%仓位
弱信号: 观望或5-10%
```

**止损止盈**
```
止损: -5% 到 -8%
止盈: +10% 到 +20%
```

**分散投资**
```
不要All In一只股票
建议3-5只股票分散
```

---

**股市有风险，投资需谨慎！**

