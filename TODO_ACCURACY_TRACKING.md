# ğŸ“Š ä¹°å–ç‚¹å‡†ç¡®ç‡ç»Ÿè®¡ç³»ç»Ÿ - å¼€å‘è®¡åˆ’

## ğŸ¯ ç›®æ ‡

å®ç°ä¹°å–ç‚¹ä¿¡å·çš„å†å²å‡†ç¡®ç‡ç»Ÿè®¡å’Œè¯„ä¼°ç³»ç»Ÿï¼Œæä¾›é‡åŒ–çš„ç­–ç•¥æœ‰æ•ˆæ€§è¯æ˜ã€‚

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½

### 1. ä¿¡å·è®°å½•ç³»ç»Ÿ
```sql
-- æ–°å¢æ•°æ®è¡¨ï¼šä¿¡å·è®°å½•è¡¨
CREATE TABLE signal_records (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    stock_code TEXT NOT NULL,
    signal_type TEXT NOT NULL,  -- 'ä¹°å…¥ç‚¹'/'å–å‡ºç‚¹'
    signal_subtype TEXT,         -- 'å¤šå‘¨æœŸå…±æŒ¯ä¹°å…¥ç‚¹'ç­‰
    signal_date TEXT NOT NULL,
    signal_price REAL NOT NULL,
    stop_loss REAL NOT NULL,
    take_profit_1 REAL,
    take_profit_2 REAL,
    confidence REAL,
    signal_strength REAL,
    reasons TEXT,
    
    -- å®é™…ç»“æœè·Ÿè¸ª
    actual_result TEXT,          -- 'pending'/'hit_stop_loss'/'hit_take_profit'/'expired'
    result_date TEXT,
    result_price REAL,
    profit_loss_pct REAL,
    days_to_result INTEGER,
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_signal_stock ON signal_records(stock_code);
CREATE INDEX idx_signal_type ON signal_records(signal_type);
CREATE INDEX idx_signal_date ON signal_records(signal_date);
```

### 2. è‡ªåŠ¨å›æµ‹è¯„ä¼°
```rust
/// å›æµ‹è¯„ä¼°ä¹°å–ç‚¹ä¿¡å·çš„å‡†ç¡®ç‡
pub async fn backtest_signal_accuracy(
    stock_code: &str,
    start_date: &str,
    end_date: &str,
) -> Result<SignalAccuracyReport, String> {
    // 1. è·å–å†å²æ•°æ®
    // 2. åœ¨æ¯ä¸ªæ—¶é—´ç‚¹ç”Ÿæˆä¹°å–ç‚¹ä¿¡å·
    // 3. è·Ÿè¸ªåç»­ä»·æ ¼èµ°åŠ¿ï¼Œåˆ¤æ–­æ˜¯å¦è§¦å‘æ­¢æŸ/æ­¢ç›ˆ
    // 4. ç»Ÿè®¡å‡†ç¡®ç‡ã€ç›ˆäºæ¯”ã€å¹³å‡æŒä»“æ—¶é—´ç­‰
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct SignalAccuracyReport {
    pub signal_type: String,
    pub total_signals: usize,
    pub hit_take_profit: usize,
    pub hit_stop_loss: usize,
    pub expired: usize,
    pub accuracy_rate: f64,          // æ­¢ç›ˆæ¬¡æ•°/æ€»æ¬¡æ•°
    pub avg_profit_pct: f64,         // å¹³å‡ç›ˆåˆ©ç™¾åˆ†æ¯”
    pub avg_loss_pct: f64,           // å¹³å‡äºæŸç™¾åˆ†æ¯”
    pub profit_loss_ratio: f64,      // ç›ˆäºæ¯”
    pub avg_holding_days: f64,       // å¹³å‡æŒä»“å¤©æ•°
    pub confidence_accuracy: Vec<(f64, f64)>,  // (ç½®ä¿¡åº¦åŒºé—´, å®é™…å‡†ç¡®ç‡)
}
```

### 3. å‰ç«¯å±•ç¤º

```typescript
interface SignalWithAccuracy extends BuySellPoint {
    historical_accuracy?: {
        total_count: number;
        success_rate: number;
        avg_profit: number;
        avg_loss: number;
    };
}
```

ç•Œé¢å±•ç¤ºï¼š
```
ğŸ’š å¤šå‘¨æœŸå…±æŒ¯ä¹°å…¥ç‚¹ (å¼ºåº¦: 89åˆ†)
å»ºè®®ä»·æ ¼: 85.50å…ƒ
æ­¢æŸä½: 82.71å…ƒ (-3.26%)
æ­¢ç›ˆä½: 88.60å…ƒ(+3.63%)
é£é™©æ”¶ç›Šæ¯”: 1:2.08
ç½®ä¿¡åº¦: 80%
ğŸ“Š å†å²å‡†ç¡®ç‡: 72% (åŸºäº156æ¬¡ä¿¡å·)
   å¹³å‡ç›ˆåˆ©: +5.2% | å¹³å‡äºæŸ: -3.1%
   ç›ˆäºæ¯”: 1.68 | å¹³å‡æŒä»“: 4.3å¤©
```

## ğŸ”§ å®ç°æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®åº“å’ŒåŸºç¡€ç»“æ„
- [ ] åˆ›å»ºä¿¡å·è®°å½•è¡¨
- [ ] å®ç°ä¿¡å·ä¿å­˜æ¥å£
- [ ] å®ç°ä¿¡å·æŸ¥è¯¢æ¥å£

### ç¬¬äºŒé˜¶æ®µï¼šå›æµ‹ç³»ç»Ÿ
- [ ] å®ç°å•ä¸ªä¿¡å·çš„ç»“æœè·Ÿè¸ªé€»è¾‘
- [ ] å®ç°æ‰¹é‡å†å²å›æµ‹åŠŸèƒ½
- [ ] è®¡ç®—å„ç±»å‡†ç¡®ç‡æŒ‡æ ‡
- [ ] æŒ‰ä¿¡å·ç±»å‹ã€ç½®ä¿¡åº¦åˆ†ç»„ç»Ÿè®¡

### ç¬¬ä¸‰é˜¶æ®µï¼šå®æ—¶è·Ÿè¸ª
- [ ] æ¯æ¬¡ç”Ÿæˆä¿¡å·æ—¶è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
- [ ] å®šæ—¶ä»»åŠ¡æ£€æŸ¥å†å²ä¿¡å·çš„å®é™…ç»“æœ
- [ ] æ›´æ–°ä¿¡å·çŠ¶æ€ï¼ˆpending â†’ hit_stop_loss/hit_take_profitï¼‰

### ç¬¬å››é˜¶æ®µï¼šå‰ç«¯é›†æˆ
- [ ] åœ¨ä¹°å–ç‚¹å¡ç‰‡ä¸­å±•ç¤ºå†å²å‡†ç¡®ç‡
- [ ] åˆ›å»ºå‡†ç¡®ç‡åˆ†æé¡µé¢
- [ ] å±•ç¤ºä¸åŒè‚¡ç¥¨ã€ä¸åŒä¿¡å·ç±»å‹çš„è¡¨ç°å¯¹æ¯”
- [ ] æä¾›å¯è§†åŒ–å›¾è¡¨ï¼ˆå‡†ç¡®ç‡è¶‹åŠ¿ã€ç›ˆäºåˆ†å¸ƒï¼‰

### ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–å’Œé¢„è­¦
- [ ] è¯†åˆ«é«˜è´¨é‡ä¿¡å·çš„ç‰¹å¾
- [ ] è‡ªåŠ¨è¿‡æ»¤å‡†ç¡®ç‡ä½çš„ä¿¡å·ç±»å‹
- [ ] æ ¹æ®å†å²è¡¨ç°è°ƒæ•´ç½®ä¿¡åº¦
- [ ] æä¾›ä¿¡å·è´¨é‡è¯„åˆ†

## ğŸ“Š è¯„ä¼°æŒ‡æ ‡

### ä¹°å…¥ç‚¹å‡†ç¡®ç‡
- **è§¦è¾¾æ­¢ç›ˆç‡**ï¼šè§¦å‘æ­¢ç›ˆä½çš„ä¿¡å·æ¯”ä¾‹
- **å¹³å‡æŒä»“æ—¶é—´**ï¼šä»ä¹°å…¥åˆ°æ­¢ç›ˆ/æ­¢æŸçš„å¤©æ•°
- **ç›ˆäºæ¯”**ï¼šå¹³å‡ç›ˆåˆ©å¹…åº¦ / å¹³å‡äºæŸå¹…åº¦
- **å¤æ™®æ¯”ç‡**ï¼šé£é™©è°ƒæ•´åæ”¶ç›Š

### å–å‡ºç‚¹å‡†ç¡®ç‡
- **é¿é™©æˆåŠŸç‡**ï¼šå–å‡ºåè‚¡ä»·ç¡®å®ä¸‹è·Œçš„æ¯”ä¾‹
- **é”™å¤±æ¶¨å¹…**ï¼šå–å‡ºåè‚¡ä»·ä¸Šæ¶¨çš„å¹³å‡å¹…åº¦
- **åŠæ—¶æ€§**ï¼šä¿¡å·å‘å‡ºæ—¶æœºçš„æœ‰æ•ˆæ€§

## ğŸ¯ ç›®æ ‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ä¼˜ç§€å€¼ |
|------|--------|--------|
| ä¹°å…¥ç‚¹æ­¢ç›ˆç‡ | >60% | >75% |
| ç›ˆäºæ¯” | >1.5:1 | >2:1 |
| å–å‡ºç‚¹é¿é™©æˆåŠŸç‡ | >70% | >85% |
| å¹³å‡æŒä»“æ—¶é—´ | 3-7å¤© | 3-5å¤© |

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

```rust
// å›æµ‹ç‰¹å®šè‚¡ç¥¨çš„ä¹°å–ç‚¹å‡†ç¡®ç‡
let report = backtest_signal_accuracy("600519.SH", "2024-01-01", "2024-10-01").await?;

println!("ä¹°å…¥ç‚¹å‡†ç¡®ç‡: {:.1}%", report.accuracy_rate * 100.0);
println!("å¹³å‡ç›ˆåˆ©: {:.2}%", report.avg_profit_pct);
println!("ç›ˆäºæ¯”: 1:{:.2}", report.profit_loss_ratio);

// è·å–ä¿¡å·æ—¶åŒ…å«å†å²å‡†ç¡®ç‡
let signals = identify_buy_points_with_accuracy(stock_data).await?;
for signal in signals {
    if let Some(accuracy) = signal.accuracy_rate {
        println!("å†å²å‡†ç¡®ç‡: {:.1}%", accuracy * 100.0);
    }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®å……åˆ†æ€§**ï¼šè‡³å°‘éœ€è¦3ä¸ªæœˆçš„å†å²ä¿¡å·æ•°æ®æ‰èƒ½è®¡ç®—å¯é çš„å‡†ç¡®ç‡
2. **å¸‚åœºç¯å¢ƒ**ï¼šç‰›å¸‚å’Œç†Šå¸‚çš„å‡†ç¡®ç‡ä¼šæœ‰æ˜¾è‘—å·®å¼‚ï¼Œéœ€è¦åˆ†åˆ«ç»Ÿè®¡
3. **æ ·æœ¬åå·®**ï¼šé¿å…è¿‡åº¦æ‹Ÿåˆï¼Œå‡†ç¡®ç‡åº”åŸºäºè¶³å¤Ÿå¤§çš„æ ·æœ¬é‡ï¼ˆ>30æ¬¡ï¼‰
4. **æ—¶æ•ˆæ€§**ï¼šæœ€è¿‘3ä¸ªæœˆçš„å‡†ç¡®ç‡æƒé‡åº”è¯¥æ›´é«˜
5. **é£é™©æç¤º**ï¼šå†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥æ”¶ç›Šï¼Œä»…ä¾›å‚è€ƒ

---

**ä¼˜å…ˆçº§**ï¼šé«˜
**é¢„è®¡å·¥æ—¶**ï¼š4-6å¤©
**ä¾èµ–**ï¼šç°æœ‰é¢„æµ‹ç³»ç»Ÿå’Œå›æµ‹æ¡†æ¶
**è´Ÿè´£äºº**ï¼šå¾…åˆ†é… 